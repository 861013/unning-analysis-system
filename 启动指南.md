# 跑步分析系统 Demo - 详细启动指南

本文档提供详细的启动操作步骤，帮助您成功运行跑步分析系统。

---

## 📋 启动前准备

### 1. 检查系统要求

确保您的系统已安装以下软件：
- ✅ Python 3.12.3（已安装）
- ✅ MongoDB（已安装）
- ✅ 终端访问权限
- ✅ 浏览器（Chrome、Firefox、Edge等）

### 2. 确认项目位置

项目位于：
```
demo/
```

---

## 🚀 详细启动步骤

### 步骤1: 启动MongoDB服务

**1.1 打开第一个终端窗口**

按 `Ctrl+Alt+T` 打开终端，或从应用程序菜单打开终端。

**1.2 检查MongoDB服务状态**

```bash
# 方式一：直接查看（通常不需要密码）
systemctl status mongod

# 方式二：如果需要sudo权限
sudo systemctl status mongod
```

**1.3 如果MongoDB未运行，启动服务**

如果服务未运行，执行以下命令：

```bash
sudo systemctl start mongod
# 输入您的系统密码
```

**1.4 验证MongoDB服务已启动**

```bash
# 方式一：直接查看（通常不需要密码）
systemctl status mongod

# 方式二：如果需要sudo权限
sudo systemctl status mongod
```

您应该看到类似以下输出，表示服务正在运行：
```
● mongod.service - MongoDB Database Server
     Loaded: loaded (/lib/systemd/system/mongod.service; enabled; vendor preset: enabled)
     Active: active (running) since ...
```

**1.5 设置MongoDB开机自启（可选）**

```bash
sudo systemctl enable mongod
# 输入您的系统密码
```

---

### 步骤2: 启动后端服务

**2.1 在终端中导航到项目目录**

```bash
cd demo
```

**2.2 使用启动脚本启动后端（推荐方式）**

```bash
./start_backend.sh
```

**或者手动启动后端服务：**

```bash
# 进入后端目录
cd backend

# 激活Python虚拟环境
source venv/bin/activate

# 启动服务
python main.py
```

**2.3 验证后端服务已启动**

您应该看到类似以下输出：

```
正在启动后端服务...
INFO:     Started server process [31807]
INFO:     Waiting for application startup.
✅ 已连接到MongoDB: mongodb://localhost:27017/running_analysis
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
```

**重要提示：**
- ✅ 看到 "✅ 已连接到MongoDB" 表示数据库连接成功
- ✅ 看到 "Uvicorn running on http://0.0.0.0:8000" 表示后端服务已启动
- ⚠️ **保持此终端窗口打开**，不要关闭，后端服务需要持续运行

**2.4 测试后端API（可选）**

打开新的终端窗口，测试API是否正常工作：

```bash
curl http://localhost:8000/
```

您应该看到JSON格式的API信息响应。

---

### 步骤3: 启动前端服务

**3.1 打开第二个终端窗口**

按 `Ctrl+Alt+T` 再打开一个新的终端窗口，或者使用 `Ctrl+Shift+T` 在当前终端中打开新标签页。

**3.2 导航到项目目录**

```bash
cd demo
```

**3.3 使用启动脚本启动前端（推荐方式）**

```bash
./start_frontend.sh
```

**或者手动启动前端服务：**

```bash
# 进入前端目录
cd frontend

# 启动HTTP服务器
python3 -m http.server 8080
```

**3.4 验证前端服务已启动**

您应该看到类似以下输出：

```
正在启动前端服务...
请在浏览器中访问: http://localhost:8080
Serving HTTP on 0.0.0.0 port 8080 (http://0.0.0.0:8080/) ...
```

**重要提示：**
- ✅ 看到 "Serving HTTP on 0.0.0.0 port 8080" 表示前端服务已启动
- ⚠️ **保持此终端窗口打开**，不要关闭，前端服务需要持续运行

---

### 步骤4: 访问应用程序

**4.1 打开浏览器**

打开您喜欢的浏览器（Chrome、Firefox、Edge等）。

**4.2 访问应用地址**

在浏览器地址栏中输入：

```
http://localhost:8080
```

或者：

```
http://127.0.0.1:8080
```

**4.3 验证应用正常运行**

您应该看到：
- ✅ 跑步分析系统的欢迎页面
- ✅ 顶部有四个标签页：数据录入、数据列表、数据图表、数据导出
- ✅ 页面样式正常显示

---

## 🎯 使用应用

### 功能说明

1. **数据录入标签页**
   - 填写运动数据表单
   - 包括基础信息、手环数据、跑步机数据
   - 点击"提交数据"按钮保存数据

2. **数据列表标签页**
   - 查看所有已保存的运动数据
   - 可以按用户ID筛选
   - 点击"刷新"按钮更新数据

3. **数据图表标签页**
   - 查看心率、配速、卡路里的趋势图表
   - 查看统计数据（平均值、最大值、最小值）

4. **数据导出标签页**
   - 点击"导出CSV"按钮下载所有数据为CSV文件

---

## ⚠️ 常见问题排查

### 问题1: MongoDB服务无法启动

**症状：**
```
Failed to start mongod.service
```

**解决方案：**
```bash
# 检查MongoDB是否已安装
which mongod

# 如果未安装，安装MongoDB
sudo apt-get update
sudo apt-get install mongodb

# 检查服务状态
systemctl status mongod

# 启动服务
sudo systemctl start mongod
```

### 问题2: 后端服务无法启动

**症状：**
```
ModuleNotFoundError: No module named 'fastapi'
```

**解决方案：**
```bash
cd /home/hadoop/nosql/run/demo/backend
source venv/bin/activate
pip install -r requirements.txt
```

### 问题3: 后端无法连接MongoDB

**症状：**
```
Connection refused
```

**解决方案：**
```bash
# 确保MongoDB服务正在运行（通常不需要密码）
systemctl status mongod

# 如果需要sudo权限
sudo systemctl status mongod

# 如果未运行，启动服务
sudo systemctl start mongod
```

### 问题4: 前端无法访问API

**症状：**
```
Failed to fetch
```

**解决方案：**
1. 确保后端服务正在运行（检查步骤2）
2. 检查后端服务地址是否正确（`http://localhost:8000`）
3. 检查浏览器控制台是否有CORS错误
4. 如果使用直接打开HTML文件的方式，请改用HTTP服务器方式

### 问题5: 端口被占用

**症状：**
```
Address already in use
```

**解决方案：**
```bash
# 查找占用端口的进程
sudo lsof -i :8000  # 后端端口
sudo lsof -i :8080  # 前端端口

# 杀死占用端口的进程
sudo kill -9 <PID>
```

---

## 🛑 停止服务

### 停止后端服务

在运行后端服务的终端窗口中：
1. 按 `Ctrl+C` 停止服务
2. 等待服务完全停止

### 停止前端服务

在运行前端服务的终端窗口中：
1. 按 `Ctrl+C` 停止服务
2. 等待服务完全停止

### 停止MongoDB服务（可选）

```bash
sudo systemctl stop mongod
```

---

## 📝 快速启动命令总结

### 一键启动脚本（需要三个终端窗口）

**终端1 - MongoDB服务：**
```bash
sudo systemctl start mongod
```

**终端2 - 后端服务：**
```bash
cd demo && ./start_backend.sh
```

**终端3 - 前端服务：**
```bash
cd demo && ./start_frontend.sh
```

**浏览器：**
```
http://localhost:8080
```

---

## ✅ 启动检查清单

在访问应用前，请确认：

- [ ] MongoDB服务正在运行
- [ ] 后端服务已启动（显示 "Uvicorn running on http://0.0.0.0:8000"）
- [ ] 后端已连接到MongoDB（显示 "✅ 已连接到MongoDB"）
- [ ] 前端服务已启动（显示 "Serving HTTP on 0.0.0.0 port 8080"）
- [ ] 浏览器已打开并访问 `http://localhost:8080`
- [ ] 页面正常显示，没有错误信息

---

## 📞 获取帮助

如果遇到问题，请查看：
- 📄 `README.md` - 项目说明文档
- 📄 `PROJECT_STRUCTURE.md` - 项目结构说明
- 📄 `功能实现总结.md` - 功能实现总结
- 📄 `功能对照与优化计划.md` - 功能对照和优化计划

---

## 🎉 成功启动后的下一步

1. **录入测试数据**：在"数据录入"标签页填写一些测试数据
2. **查看数据列表**：在"数据列表"标签页查看已保存的数据
3. **查看图表**：在"数据图表"标签页查看数据可视化
4. **导出数据**：在"数据导出"标签页导出CSV文件

祝您使用愉快！🚀


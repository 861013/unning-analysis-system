# 微信小程序使用指南

本文档详细说明如何打开、配置和运行跑步分析系统的微信小程序。

---

## 📋 前置准备

### 1. 注册微信小程序账号

1. 访问 [微信公众平台](https://mp.weixin.qq.com/)
2. 点击"立即注册" → 选择"小程序"
3. 填写账号信息（邮箱、密码等）
4. 完成邮箱验证和账号信息填写
5. **个人开发者免费注册**

### 2. 获取AppID

1. 登录 [微信公众平台](https://mp.weixin.qq.com/)
2. 进入"开发" → "开发管理" → "开发设置"
3. 找到"AppID(小程序ID)"，复制保存

---

## 🛠️ 安装微信开发者工具

### Windows系统

1. 访问 [微信开发者工具下载页面](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)
2. 下载Windows版本安装包
3. 运行安装程序，按提示完成安装
4. 启动微信开发者工具

### Ubuntu/Linux系统

**方式一：使用Wine运行（推荐）**

1. 安装Wine：
   ```bash
   sudo apt-get update
   sudo apt-get install wine
   ```

2. 下载微信开发者工具Windows版本

3. 使用Wine运行：
   ```bash
   wine 微信开发者工具安装包.exe
   ```

**方式二：使用虚拟机**

1. 安装VirtualBox或VMware
2. 安装Windows虚拟机
3. 在虚拟机中安装微信开发者工具

**方式三：使用远程桌面**

1. 在Windows机器上安装微信开发者工具
2. 使用远程桌面连接Windows机器进行开发

---

## 🚀 打开小程序项目

### 步骤1: 启动微信开发者工具

1. 打开微信开发者工具
2. 使用微信扫码登录

### 步骤2: 创建/导入项目

**方式一：导入已有项目（推荐）**

1. 点击"+"或"导入项目"
2. 选择项目目录：`/home/hadoop/nosql/run/demo/miniprogram`
3. 填写项目信息：
   - **项目名称**：跑步分析系统
   - **AppID**：
     - 如果有AppID，填写您的AppID
     - 如果没有AppID，选择"测试号"或"不使用云服务"
   - **开发模式**：小程序
4. 点击"导入"

**方式二：新建项目**

1. 点击"新建项目"
2. 填写项目信息（同上）
3. 选择项目目录：`/home/hadoop/nosql/run/demo/miniprogram`
4. 点击"新建"

### 步骤3: 配置项目

#### 3.1 检查项目结构

确保项目目录结构如下：
```
miniprogram/
├── app.js              # 小程序入口
├── app.json            # 小程序配置
├── sitemap.json        # 站点地图
├── pages/              # 页面目录
│   ├── index/          # 首页
│   ├── login/          # 登录页
│   ├── input/          # 数据录入页
│   ├── list/           # 数据列表页
│   ├── chart/          # 图表展示页
│   └── plan/           # 训练计划页
├── utils/              # 工具函数
│   └── api.js          # API请求封装
├── components/         # 组件目录
└── images/             # 图片资源
```

#### 3.2 配置API地址

编辑 `miniprogram/app.js`，修改API地址：

```javascript
globalData: {
  // 开发环境（本地）
  apiBaseUrl: 'http://localhost:8000',
  
  // 生产环境（需要配置HTTPS域名）
  // apiBaseUrl: 'https://your-api-domain.com',
  
  userInfo: null,
  isLoggedIn: false,
  token: null
}
```

**注意：**
- 开发环境可以使用 `http://localhost:8000`
- 生产环境必须使用HTTPS域名
- 需要在微信小程序后台配置服务器域名

---

## ⚙️ 配置服务器域名

### 1. 登录微信公众平台

1. 访问 [微信公众平台](https://mp.weixin.qq.com/)
2. 登录您的小程序账号

### 2. 配置服务器域名

1. 进入"开发" → "开发管理" → "开发设置"
2. 找到"服务器域名"配置
3. 点击"修改"
4. 配置以下域名：

**request合法域名：**
```
http://localhost:8000          # 开发环境（仅开发工具可用）
https://your-api-domain.com    # 生产环境
```

**注意：**
- 开发环境：可以在开发工具中勾选"不校验合法域名"
- 生产环境：必须配置HTTPS域名
- 域名需要备案（国内服务器）

### 3. 开发环境设置

在微信开发者工具中：

1. 点击右上角"详情"
2. 勾选"不校验合法域名、web-view（业务域名）、TLS版本以及HTTPS证书"
3. 这样可以在开发时使用 `http://localhost:8000`

---

## 🎯 运行小程序

### 步骤1: 确保后端服务运行

在运行小程序之前，确保后端服务正在运行：

```bash
# 终端1：启动MongoDB
echo "zhao" | sudo -S systemctl start mongod

# 终端2：启动后端服务
cd /home/hadoop/nosql/run/demo
./start_backend.sh
```

后端服务应该在 `http://localhost:8000` 运行。

### 步骤2: 在开发者工具中运行

1. 在微信开发者工具中，点击"编译"按钮
2. 小程序会自动编译并在模拟器中运行
3. 您应该看到登录页面

### 步骤3: 测试功能

1. **登录/注册**
   - 点击"注册"创建新账号
   - 或使用已有账号登录
   - 支持手机号/邮箱/微信登录

2. **首页**
   - 查看用户信息
   - 查看统计数据（平均心率、配速、卡路里）

3. **数据录入**
   - 点击底部"录入"标签
   - 填写运动数据并提交

4. **数据列表**
   - 点击底部"数据"标签
   - 查看历史运动数据

5. **图表展示**
   - 点击底部"图表"标签
   - 查看数据可视化图表

---

## 📱 真机调试

### 方式一：预览

1. 在微信开发者工具中，点击"预览"
2. 使用微信扫码
3. 在手机上打开小程序

### 方式二：真机调试

1. 在微信开发者工具中，点击"真机调试"
2. 使用微信扫码
3. 在手机上打开小程序，可以查看调试信息

**注意：**
- 真机调试需要手机和电脑在同一网络
- 需要确保后端服务可以被手机访问
- 如果使用 `localhost`，需要改为电脑的IP地址

### 修改API地址为局域网IP

1. 查看电脑IP地址：
   ```bash
   # Linux
   ip addr show
   # 或
   ifconfig
   
   # 找到局域网IP，例如：192.168.1.100
   ```

2. 修改 `miniprogram/app.js`：
   ```javascript
   globalData: {
     apiBaseUrl: 'http://192.168.1.100:8000',  // 改为您的电脑IP
     userInfo: null,
     isLoggedIn: false,
     token: null
   }
   ```

3. 重新编译小程序

---

## 🔧 常见问题

### 问题1: 无法连接后端API

**症状：**
```
request:fail connect ETIMEDOUT
```

**解决方案：**

1. **检查后端服务是否运行**
   ```bash
   curl http://localhost:8000/
   ```

2. **检查API地址配置**
   - 确认 `app.js` 中的 `apiBaseUrl` 正确
   - 真机调试时使用局域网IP，不是 `localhost`

3. **检查网络连接**
   - 确保手机和电脑在同一网络
   - 检查防火墙设置

### 问题2: 登录失败

**症状：**
```
登录失败：网络错误
```

**解决方案：**

1. **检查后端服务**
   - 确保后端服务正在运行
   - 检查API地址是否正确

2. **检查用户数据**
   - 确保MongoDB服务运行
   - 检查用户数据是否正确

### 问题3: 无法显示图片

**症状：**
```
图片不显示
```

**解决方案：**

1. **检查图片路径**
   - 确保图片文件存在于 `images/` 目录
   - 检查图片路径是否正确

2. **添加占位图片**
   - 如果图片不存在，可以添加占位图片
   - 或使用在线图片URL

### 问题4: 页面空白

**症状：**
```
页面显示空白
```

**解决方案：**

1. **检查控制台错误**
   - 在开发者工具中查看控制台
   - 查看是否有JavaScript错误

2. **检查页面文件**
   - 确保所有页面文件存在（.js, .wxml, .wxss）
   - 检查 `app.json` 中的页面路径是否正确

3. **检查API请求**
   - 查看网络请求是否成功
   - 检查API响应数据格式

---

## 📝 开发建议

### 1. 开发流程

1. **本地开发**
   - 使用微信开发者工具进行开发
   - 使用 `http://localhost:8000` 连接后端
   - 勾选"不校验合法域名"

2. **真机测试**
   - 使用局域网IP进行真机测试
   - 测试各种功能是否正常

3. **生产部署**
   - 配置HTTPS域名
   - 在微信公众平台配置服务器域名
   - 上传代码并提交审核

### 2. 调试技巧

1. **使用控制台**
   - 在开发者工具中查看控制台输出
   - 使用 `console.log()` 输出调试信息

2. **使用网络面板**
   - 查看API请求和响应
   - 检查请求头和数据格式

3. **使用调试器**
   - 设置断点进行调试
   - 查看变量值

### 3. 性能优化

1. **减少API请求**
   - 使用本地缓存
   - 合并多个请求

2. **优化图片**
   - 压缩图片大小
   - 使用合适的图片格式

3. **代码优化**
   - 减少不必要的渲染
   - 使用 `wx:if` 和 `hidden` 控制显示

---

## 🎉 快速开始

### 一键启动（开发环境）

1. **启动后端服务**
   ```bash
   cd /home/hadoop/nosql/run/demo
   ./start_backend.sh
   ```

2. **打开微信开发者工具**
   - 导入项目：`/home/hadoop/nosql/run/demo/miniprogram`
   - 选择"测试号"或填写AppID
   - 勾选"不校验合法域名"

3. **点击"编译"**
   - 小程序会自动运行
   - 开始测试功能

---

## 📚 相关文档

- 📄 `/home/hadoop/nosql/run/demo/README.md` - 项目说明
- 📄 `/home/hadoop/nosql/run/demo/启动指南.md` - 后端启动指南
- 📄 `/home/hadoop/nosql/run/demo/功能实现总结.md` - 功能实现总结
- 📄 `/home/hadoop/nosql/run/设计思维流程与项目思路.md` - 项目设计文档

---

## 💡 提示

1. **开发环境**：可以使用 `http://localhost:8000`，勾选"不校验合法域名"
2. **真机测试**：需要使用局域网IP，例如 `http://192.168.1.100:8000`
3. **生产环境**：必须使用HTTPS域名，并在微信公众平台配置
4. **测试号**：如果没有AppID，可以使用测试号进行开发测试

祝您开发顺利！🚀

